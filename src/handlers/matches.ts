import express, { Request, Response } from "express";
import { MVSQueries } from "../interfaces/queries_types";
import { onMatchmakerStarted } from "../websocket_handlers/websocket_handler";

export async function handleMatches_id(req: Request<{}, {}, {}, {}>, res: Response) {
  res.send({
    updated_at: { _hydra_unix_date: 1742265244 },
    created_at: { _hydra_unix_date: 1742265244 },
    account_id: null,
    completion_time: null,
    name: "white-green-wind-breeze-OS5dF",
    state: "open",
    access_level: "public",
    origin: "client",
    rand: 0.6975513760957894,
    winning_team: [],
    win: [],
    loss: [],
    draw: null,
    arbitration: null,
    data: {},
    server_data: {
      Teams: [
        {
          TeamIndex: 0,
          Players: {
            "63cef97ced0619f458cfac8f": {
              Account: { id: "63cef97ced0619f458cfac8f" },
              JoinedAt: { _hydra_unix_date: 1742265244 },
              BotSettingSlug: "",
              LobbyPlayerIndex: 0,
              CrossplayPreference: 1,
            },
          },
          Length: 1,
        },
        { TeamIndex: 1, Players: {}, Length: 0 },
        { TeamIndex: 2, Players: {}, Length: 0 },
        { TeamIndex: 3, Players: {}, Length: 0 },
        { TeamIndex: 4, Players: {}, Length: 0 },
      ],
      LeaderID: "63cef97ced0619f458cfac8f",
      LobbyType: 0,
      ReadyPlayers: {},
      PlayerGameplayPreferences: { "63cef97ced0619f458cfac8f": 544 },
      PlayerAutoPartyPreferences: { "63cef97ced0619f458cfac8f": true },
      GameVersion: "CLIENT:2F322-Retail DATA:4CF442B2 PERKS:1",
      HissCrc: 1167552915,
      Platforms: { "63cef97ced0619f458cfac8f": "PC" },
      AllMultiplayParams: {
        "1": { MultiplayClusterSlug: "ec2-us-east-1-dokken", MultiplayProfileId: "1252499", MultiplayRegionId: "" },
        "2": {
          MultiplayClusterSlug: "ec2-us-east-1-dokken",
          MultiplayProfileId: "1252922",
          MultiplayRegionId: "19c465a7-f21f-11ea-a5e3-0954f48c5682",
        },
        "3": { MultiplayClusterSlug: "", MultiplayProfileId: "1252925", MultiplayRegionId: "" },
        "4": {
          MultiplayClusterSlug: "ec2-us-east-1-dokken",
          MultiplayProfileId: "1252928",
          MultiplayRegionId: "19c465a7-f21f-11ea-a5e3-0954f48c5682",
        },
      },
      LockedLoadouts: { "63cef97ced0619f458cfac8f": { Character: "character_wonder_woman", Skin: "skin_wonder_woman_default" } },
      ModeString: "1v1",
      IsLobbyJoinable: true,
    },
    players: {
      all: [
        {
          account_id: "63cef97ced0619f458cfac8f",
          source: {},
          state: "join",
          data: {},
          identity: {
            username: "dark-wild-grass-voice-yRPU2",
            avatar: "https://s3.amazonaws.com/wb-agora-hydra-ugc-dokken/identicons/identicon.584.png",
            default_username: true,
            personal_data: {},
            alternate: {
              wb_network: [{ id: "pafd8d7950aa1484ea791d06662fa75ce", username: "MultiVersusKOTH", avatar: null, email: null }],
              steam: [
                {
                  id: "76561195177950873",
                  username: "multiversuskoth",
                  avatar: "https://avatars.steamstatic.com/fef49e7fa7e1997310d705b2a6158ff8dc1cdfeb.jpg",
                  email: null,
                },
              ],
            },
            usernames: [
              { auth: "hydra", username: "dark-wild-grass-voice-yrpu2" },
              { auth: "steam", username: "multiversuskoth" },
              { auth: "wb_network", username: "multiversuskoth" },
            ],
            platforms: ["steam"],
            current_platform: "steam",
            is_cross_platform: false,
          },
        },
      ],
      current: ["63cef97ced0619f458cfac8f"],
      count: 1,
    },
    matchmaking: null,
    cluster: "ec2-us-east-1-dokken",
    last_warning_time: null,
    template: {
      type: "async",
      name: "party_lobby",
      slug: "party_lobby",
      min_players: 2,
      max_players: 2,
      game_server_integration_enabled: false,
      game_server_config: null,
      created_at: { _hydra_unix_date: 1714587806 },
      updated_at: { _hydra_unix_date: 1729015209 },
      data: {},
      id: "6632889e358a2a62107ca7fb",
    },
    criteria: { slug: null },
    shortcode: null,
    id: "67d8db9c0bd3637fea0c872e",
    access: "public",
  });
}

export async function handleMatches_all_id(req: Request<{}, {}, {}, MVSQueries.Matches_all_id_QUERY>, res: Response) {
  res.send({
    matches: [],
    total_matches: 0,
    current_page: 1,
    total_pages: 1,
  });
}

export async function handleMatches_matchmaking_1v1_retail_request(req: Request<{}, {}, {}, {}>, res: Response) {
  const data = {
    updated_at: { _hydra_unix_date: 1742265254 },
    requester_account_id: "63cef97ced0619f458cfac8f",
    is_concurrent: false,
    concurrent_identifier: "7f394c29-9184-468f-83bf-a162c6c7dda0",
    created_at: { _hydra_unix_date: 1742265251 },
    data: {
      MultiplayParams: {
        MultiplayClusterSlug: "ec2-us-east-1-dokken",
        MultiplayProfileId: "1252922",
        MultiplayRegionId: "19c465a7-f21f-11ea-a5e3-0954f48c5682",
        MultiplayRegionSearchId: 1,
      },
      crossplay_buckets: ["All", "PC"],
      version: "CLIENT:2F322-Retail DATA:4CF442B2 PERKS:1",
      matchmaking_rating: 606.406234735998,
      player_count: 1,
      double_character_key: "character_wonder_woman",
      rp: 0,
      allowed_buckets: ["Any"],
      allowed_buckets_relaxed: ["Any"],
    },
    server_data: null,
    criteria_slug: "1v1-retail",
    cluster: "ec2-us-east-1-dokken",
    players_connection_info: {
      "63cef97ced0619f458cfac8f": {
        game_server_region_data: [
          { region_id: "19c465a7-f21f-11ea-a5e3-0954f48c5682", latency: 0.04239736124873161 },
          { region_id: "19bf18ce-f21f-11ea-b94f-f946c68d5a4f", latency: 0.032917093485593796 },
          { region_id: "19c714ff-f21f-11ea-b144-4d87911ee195", latency: 0.07239044457674026 },
          { region_id: "657d35f8-ca5e-11ec-85a7-b6a275757dc0", latency: 0.04306681081652641 },
          { region_id: "36e4f578-e5de-11ec-9b71-3e51faa28080", latency: 0.06971535831689835 },
          { region_id: "19cb2fef-f21f-11ea-b925-3d9c90e67151", latency: 0.056540388613939285 },
          { region_id: "19c32880-f21f-11ea-a907-512b3194e649", latency: 0.11248181760311127 },
          { region_id: "19cc9701-f21f-11ea-bfb9-5d272145d31d", latency: 0.12218119204044342 },
          { region_id: "19c5bb72-f21f-11ea-bfec-c59755e2312c", latency: 0.11600212007761002 },
          { region_id: "19c86c46-f21f-11ea-a140-f58c0daacbb8", latency: 0.12285491079092026 },
          { region_id: "f04a5e72-2891-11ed-8e82-fe3ccb088dde", latency: 0.050994955003261566 },
        ],
      },
    },
    player_connections: { "63cef97ced0619f458cfac8f": ["42ae2f26-ad91-4516-8a25-34ae9f0041bf"] },
    players: {
      "63cef97ced0619f458cfac8f": {
        updated_at: null,
        account_id: "63cef97ced0619f458cfac8f",
        created_at: null,
        last_login: null,
        last_inbox_read: null,
        points: null,
        data: {},
        server_data: {},
        private_data: {},
        server_owner_data: {},
        inventory: {},
        matches: {},
        cross_match_results: {},
        notifications: {},
        aggregates: {},
        calculations: {},
        files: [],
        user_segments: [],
        random_distribution: null,
        id: "63cef97ced0619f458cfac90",
      },
    },
    groups: [1],
    relationships: [],
    recently_played: { "63cef97ced0619f458cfac8f": [] },
    from_match: "67d8db9c0bd3637fea0c872e",
    reuse_match: false,
    party_id: null,
    state: 2,
    user_rule_config: [],
    game_server: {
      unique_key: null,
      backend: "multiplay",
      launch_configs: [
        {
          profile_id: "1252922",
          fleet_id: "6edd4138-20ef-11ec-a2b7-4a5119a45304",
          region_id: "19c714ff-f21f-11ea-b144-4d87911ee195",
          backend: "multiplay",
        },
        {
          profile_id: "1252922",
          fleet_id: "6edd4138-20ef-11ec-a2b7-4a5119a45304",
          region_id: "19c465a7-f21f-11ea-a5e3-0954f48c5682",
          backend: "multiplay",
        },
        {
          profile_id: "1252922",
          fleet_id: "6edd4138-20ef-11ec-a2b7-4a5119a45304",
          region_id: "19c32880-f21f-11ea-a907-512b3194e649",
          backend: "multiplay",
        },
        {
          profile_id: "1252922",
          fleet_id: "6edd4138-20ef-11ec-a2b7-4a5119a45304",
          region_id: "19bf18ce-f21f-11ea-b94f-f946c68d5a4f",
          backend: "multiplay",
        },
        {
          profile_id: "1252922",
          fleet_id: "6edd4138-20ef-11ec-a2b7-4a5119a45304",
          region_id: "19cc9701-f21f-11ea-bfb9-5d272145d31d",
          backend: "multiplay",
        },
        {
          profile_id: "1252922",
          fleet_id: "6edd4138-20ef-11ec-a2b7-4a5119a45304",
          region_id: "19c5bb72-f21f-11ea-bfec-c59755e2312c",
          backend: "multiplay",
        },
        {
          profile_id: "1252922",
          fleet_id: "6edd4138-20ef-11ec-a2b7-4a5119a45304",
          region_id: "19c86c46-f21f-11ea-a140-f58c0daacbb8",
          backend: "multiplay",
        },
        {
          profile_id: "1252922",
          fleet_id: "6edd4138-20ef-11ec-a2b7-4a5119a45304",
          region_id: "657d35f8-ca5e-11ec-85a7-b6a275757dc0",
          backend: "multiplay",
        },
        {
          profile_id: "1252922",
          fleet_id: "6edd4138-20ef-11ec-a2b7-4a5119a45304",
          region_id: "36e4f578-e5de-11ec-9b71-3e51faa28080",
          backend: "multiplay",
        },
        {
          profile_id: "1252922",
          fleet_id: "6edd4138-20ef-11ec-a2b7-4a5119a45304",
          region_id: "19cb2fef-f21f-11ea-b925-3d9c90e67151",
          backend: "multiplay",
        },
        {
          profile_id: "1252922",
          fleet_id: "6edd4138-20ef-11ec-a2b7-4a5119a45304",
          region_id: "f04a5e72-2891-11ed-8e82-fe3ccb088dde",
          backend: "multiplay",
        },
      ],
      optional_launch_config_params: {},
    },
    server_submitted: false,
    id: "67d8dba3e41af3c0dd4bb8d0",
  };
  res.send(data);
  onMatchmakerStarted({ MatchmakingRequestId: data.id, matchId: data.from_match });
}
